name: Weekly Public Release

on:
  schedule:
    - cron: "0 0 * * 0" # Runs at 00:00 UTC every Sunday
  workflow_dispatch:

jobs:
  publish-lite:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Private Engine
        uses: actions/checkout@v3

      - name: Setup Go
        uses: actions/setup-go@v4
        with:
          go-version: "1.25"

      - name: Generate Lite File
        run: go run publisher/main.go
        # Creates public_export/shadow-ai-lite.txt

      - name: Prepare Public Readme
        run: |
          # Copy the community readme to the export folder as the default README.md
          cp README_COMMUNITY.md public_export/README.md

          # Verify the folder content before pushing (for logs)
          ls -la public_export/

      - name: Push to Public Repo
        uses: cpina/github-action-push-to-another-repository@main
        env:
          API_TOKEN_GITHUB: ${{ secrets.PUBLIC_REPO_TOKEN }}
        with:
          source-directory: "public_export"
          destination-github-username: "Tobiwan-Cloud-Solutions"
          destination-repository-name: "ai-safety-blocklist"
          user-email: "bot@sentinelflow.io"
          target-branch: main
          commit-message: "Weekly Community Update"
